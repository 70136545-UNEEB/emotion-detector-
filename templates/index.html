<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotion Detection from Text</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üòä</text></svg>">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-smile"></i> Emotion Detector</h1>
            <p>Analyze emotions in your text using AI and Machine Learning</p>
        </header>

        <div class="main-content">
            <div class="instructions">
                <h4><i class="fas fa-info-circle"></i> How to use this tool:</h4>
                <ul>
                    <li><strong>Single Analysis:</strong> Enter text in the first box and click "Analyze Emotion"</li>
                    <li><strong>Batch Analysis:</strong> Enter multiple texts (one per line) in the second box</li>
                    <li><strong>Quick Actions:</strong> Press <kbd>Ctrl + Enter</kbd> to analyze text quickly</li>
                    <li><strong>Supported Emotions:</strong> Joy, Sadness, Anger, Love, Fear, Surprise</li>
                </ul>
            </div>

            <div class="input-section">
                <h2><i class="fas fa-edit"></i> Single Text Analysis</h2>
                <textarea 
                    id="textInput" 
                    placeholder="Type your text here (tweet, message, review, etc.)..." 
                    rows="5"
                ></textarea>
                <div class="button-group">
                    <button id="analyzeBtn">
                        <i class="fas fa-brain"></i> Analyze Emotion
                    </button>
                    <button id="sampleBtn" class="secondary-button">
                        <i class="fas fa-magic"></i> Try Sample Text
                    </button>
                    <button id="clearBtn" class="secondary-button">
                        <i class="fas fa-trash"></i> Clear
                    </button>
                </div>
                <p style="margin-top: 10px; color: #6c757d; font-size: 0.9em;">
                    <i class="fas fa-lightbulb"></i> Tip: Press <kbd>Ctrl + Enter</kbd> to analyze quickly
                </p>
            </div>

            <div class="results-section" id="resultsSection" style="display: none;">
                <h2><i class="fas fa-chart-line"></i> Analysis Results</h2>
                <div class="result-card">
                    <div class="emotion-display">
                        <span id="emotionIcon" class="emotion-icon">üòä</span>
                        <div class="emotion-text">
                            <h3 id="detectedEmotion">Joy</h3>
                            <p class="confidence">Confidence: <span id="confidenceValue">0%</span></p>
                        </div>
                    </div>
                    
                    <div class="probabilities">
                        <h4><i class="fas fa-chart-bar"></i> Emotion Probabilities</h4>
                        <div id="probabilityBars" class="probability-bars"></div>
                    </div>
                    
                    <div class="cleaned-text">
                        <p><strong><i class="fas fa-code"></i> Processed Text:</strong> <span id="cleanedText">-</span></p>
                    </div>
                </div>
            </div>

            <div class="batch-analysis">
                <h2><i class="fas fa-list"></i> Batch Text Analysis</h2>
                <textarea 
                    id="batchInput" 
                    placeholder="Enter multiple texts (one per line) for batch analysis...
Example:
I am feeling happy today
This makes me angry
I love this product" 
                    rows="5"
                ></textarea>
                <div class="button-group">
                    <button id="batchBtn">
                        <i class="fas fa-chart-bar"></i> Analyze Multiple Texts
                    </button>
                    <button id="clearBatchBtn" class="secondary-button">
                        <i class="fas fa-trash"></i> Clear All
                    </button>
                </div>
                <p style="margin-top: 10px; color: #6c757d; font-size: 0.9em;">
                    <i class="fas fa-info-circle"></i> Maximum 20 texts per batch analysis
                </p>
                
                <div id="batchResults" class="batch-results" style="display: none;">
                    <h3><i class="fas fa-tasks"></i> Batch Results</h3>
                    <div id="batchResultsContent"></div>
                </div>
            </div>
        </div>

        <footer>
            <p>
                <i class="fas fa-code"></i> Powered by Machine Learning & Natural Language Processing | 
                <i class="fas fa-cogs"></i> Built with Python, Flask, and Scikit-learn |
                <i class="fas fa-heart"></i> Designed for Emotion Analysis
            </p>
        </footer>
    </div>

    <!-- Inline JavaScript as fallback -->
    <script>
        // Emotion icons mapping
        const emotionIcons = {
            'joy': 'üòä',
            'sadness': 'üò¢', 
            'anger': 'üò†',
            'love': '‚ù§Ô∏è',
            'fear': 'üò®',
            'surprise': 'üò≤'
        };

        // Emotion colors for tags
        const emotionColors = {
            'joy': '#28a745',
            'sadness': '#6f42c1',
            'anger': '#dc3545',
            'love': '#e83e8c',
            'fear': '#ffc107',
            'surprise': '#17a2b8'
        };

        // Analyze single text
        async function analyzeText() {
            console.log('üîç Analyze text function called');
            
            const text = document.getElementById('textInput').value.trim();
            const analyzeBtn = document.getElementById('analyzeBtn');
            const resultsSection = document.getElementById('resultsSection');
            
            if (!text) {
                alert('‚ö†Ô∏è Please enter some text to analyze.');
                return;
            }
            
            if (text.length < 3) {
                alert('üìù Please enter at least 3 characters.');
                return;
            }
            
            // Show loading state
            const originalText = analyzeBtn.innerHTML;
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
            analyzeBtn.disabled = true;
            
            try {
                console.log('üì§ Sending request to server...');
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text: text })
                });
                
                const data = await response.json();
                console.log('üì• Response received:', data);
                
                if (data.success) {
                    displayResults(data);
                    resultsSection.style.display = 'block';
                    
                    // Scroll to results
                    resultsSection.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                } else {
                    alert('‚ùå Error: ' + (data.error || 'Unknown error occurred'));
                }
            } catch (error) {
                console.error('‚ùå Network error:', error);
                alert('‚ùå Failed to analyze text. Please check your connection and try again.');
            } finally {
                // Reset button
                analyzeBtn.innerHTML = originalText;
                analyzeBtn.disabled = false;
            }
        }

        // Analyze batch of texts
        async function analyzeBatch() {
            console.log('üìä Analyze batch function called');
            
            const batchInput = document.getElementById('batchInput').value.trim();
            const batchBtn = document.getElementById('batchBtn');
            const batchResults = document.getElementById('batchResults');
            
            if (!batchInput) {
                alert('‚ö†Ô∏è Please enter some texts to analyze.');
                return;
            }
            
            const texts = batchInput.split('\n').filter(text => text.trim());
            
            if (texts.length === 0) {
                alert('‚ö†Ô∏è Please enter at least one non-empty text.');
                return;
            }
            
            // Show loading state
            const originalText = batchBtn.innerHTML;
            batchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
            batchBtn.disabled = true;
            
            try {
                console.log(`üì§ Sending batch of ${texts.length} texts...`);
                const response = await fetch('/analyze_batch', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ texts: texts })
                });
                
                const data = await response.json();
                console.log('üì• Batch response received:', data);
                
                if (data.success) {
                    displayBatchResults(data);
                    batchResults.style.display = 'block';
                    
                    // Scroll to batch results
                    batchResults.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                } else {
                    alert('‚ùå Error: ' + (data.error || 'Unknown error occurred'));
                }
            } catch (error) {
                console.error('‚ùå Network error:', error);
                alert('‚ùå Failed to analyze texts. Please check your connection and try again.');
            } finally {
                // Reset button
                batchBtn.innerHTML = originalText;
                batchBtn.disabled = false;
            }
        }

        // Display single result
        function displayResults(data) {
            console.log('üé≠ Displaying results:', data);
            
            // Update emotion display
            const emotionElement = document.getElementById('detectedEmotion');
            emotionElement.textContent = data.emotion.charAt(0).toUpperCase() + data.emotion.slice(1);
            emotionElement.className = `emotion-${data.emotion}`;
            
            // Update emotion icon
            const emotionIcon = document.getElementById('emotionIcon');
            emotionIcon.textContent = emotionIcons[data.emotion] || 'üòê';
            emotionIcon.className = `emotion-icon emotion-${data.emotion}`;
            
            // Update confidence
            const confidenceValue = document.getElementById('confidenceValue');
            confidenceValue.textContent = (data.confidence * 100).toFixed(1) + '%';
            
            // Update cleaned text
            document.getElementById('cleanedText').textContent = data.cleaned_text || 'Not available';
            
            // Update probability bars
            const probabilityBars = document.getElementById('probabilityBars');
            probabilityBars.innerHTML = '';
            
            if (data.probabilities) {
                Object.entries(data.probabilities)
                    .sort(([,a], [,b]) => b - a)
                    .forEach(([emotion, probability]) => {
                        const barContainer = document.createElement('div');
                        barContainer.className = 'probability-bar';
                        
                        const barLabel = document.createElement('div');
                        barLabel.className = 'bar-label';
                        barLabel.innerHTML = `
                            <span class="emotion-${emotion}">${emotion.charAt(0).toUpperCase() + emotion.slice(1)}</span>
                            <span>${(probability * 100).toFixed(1)}%</span>
                        `;
                        
                        const barFillContainer = document.createElement('div');
                        barFillContainer.className = 'bar-container';
                        
                        const barFill = document.createElement('div');
                        barFill.className = 'bar-fill';
                        barFill.style.width = `${probability * 100}%`;
                        barFill.style.backgroundColor = emotionColors[emotion] || '#6c757d';
                        
                        barFillContainer.appendChild(barFill);
                        barContainer.appendChild(barLabel);
                        barContainer.appendChild(barFillContainer);
                        probabilityBars.appendChild(barContainer);
                    });
            }
        }

        // Display batch results
        function displayBatchResults(data) {
            console.log('üìà Displaying batch results:', data);
            
            const batchResultsContent = document.getElementById('batchResultsContent');
            batchResultsContent.innerHTML = '';
            
            if (data.results && data.results.length > 0) {
                data.results.forEach((result, index) => {
                    const batchItem = document.createElement('div');
                    batchItem.className = 'batch-item';
                    
                    batchItem.innerHTML = `
                        <div class="text-content">
                            <strong>${index + 1}.</strong> ${result.text}
                        </div>
                        <div class="emotion-result">
                            <span class="emotion-tag" style="background-color: ${emotionColors[result.emotion] || '#6c757d'}">
                                ${emotionIcons[result.emotion] || 'üòê'} ${result.emotion.toUpperCase()}
                            </span>
                            <span class="confidence-badge">${(result.confidence * 100).toFixed(1)}%</span>
                        </div>
                    `;
                    
                    batchResultsContent.appendChild(batchItem);
                });
            } else {
                batchResultsContent.innerHTML = '<p>No results to display.</p>';
            }
        }

        // Add sample text for testing
        function addSampleText() {
            const sampleTexts = [
                "I am feeling absolutely wonderful today! Everything is going great!",
                "This situation is making me incredibly angry and frustrated!",
                "I'm really scared and anxious about what might happen tomorrow.",
                "I love this so much, it's the most amazing thing ever!",
                "I feel so sad and lonely right now, everything seems hopeless.",
                "Wow, that was completely unexpected and surprising!"
            ];
            
            const randomText = sampleTexts[Math.floor(Math.random() * sampleTexts.length)];
            document.getElementById('textInput').value = randomText;
        }

        // Clear input fields
        function clearInput(fieldId) {
            document.getElementById(fieldId).value = '';
        }

        // Add event listeners when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Emotion Detector loaded successfully!');
            
            // Add event listeners to buttons
            document.getElementById('analyzeBtn').addEventListener('click', analyzeText);
            document.getElementById('sampleBtn').addEventListener('click', addSampleText);
            document.getElementById('clearBtn').addEventListener('click', () => clearInput('textInput'));
            document.getElementById('batchBtn').addEventListener('click', analyzeBatch);
            document.getElementById('clearBatchBtn').addEventListener('click', () => clearInput('batchInput'));
            
            // Add Enter key support
            document.getElementById('textInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && e.ctrlKey) {
                    analyzeText();
                }
            });

            document.getElementById('batchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && e.ctrlKey) {
                    analyzeBatch();
                }
            });
            
            console.log('‚úÖ All event listeners set up!');
        });
    </script>
</body>
</html>